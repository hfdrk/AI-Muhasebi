{"numTotalTestSuites":141,"numPassedTestSuites":141,"numFailedTestSuites":0,"numPendingTestSuites":0,"numTotalTests":241,"numPassedTests":151,"numFailedTests":90,"numPendingTests":0,"numTodoTests":0,"startTime":1765220235947,"success":false,"testResults":[{"assertionResults":[{"ancestorTitles":["","Audit Logs Integration Tests","GET /api/v1/audit-logs"],"fullName":" Audit Logs Integration Tests GET /api/v1/audit-logs should allow TenantOwner to view audit logs","status":"failed","title":"should allow TenantOwner to view audit logs","duration":11254,"failureMessages":["\nInvalid `prisma.userTenantMembership.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/test-utils/test-auth.ts:130:52\n\n  127   });\n  128 } else {\n  129   // Create new membership\n→ 130   membership = await prisma.userTenantMembership.create(\nForeign key constraint violated: `user_tenant_memberships_tenant_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Audit Logs Integration Tests","GET /api/v1/audit-logs"],"fullName":" Audit Logs Integration Tests GET /api/v1/audit-logs should allow Accountant to view audit logs","status":"failed","title":"should allow Accountant to view audit logs","duration":10819,"failureMessages":["Failed to get auth token: E-posta veya şifre hatalı."],"location":{"line":260,"column":15}},{"ancestorTitles":["","Audit Logs Integration Tests","GET /api/v1/audit-logs"],"fullName":" Audit Logs Integration Tests GET /api/v1/audit-logs should reject Staff from viewing audit logs","status":"failed","title":"should reject Staff from viewing audit logs","duration":11174,"failureMessages":["Failed to get auth token: E-posta veya şifre hatalı."],"location":{"line":260,"column":15}},{"ancestorTitles":["","Audit Logs Integration Tests","GET /api/v1/audit-logs"],"fullName":" Audit Logs Integration Tests GET /api/v1/audit-logs should reject ReadOnly from viewing audit logs","status":"failed","title":"should reject ReadOnly from viewing audit logs","duration":6083,"failureMessages":["\nInvalid `prisma.auditLog.createMany()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/audit-logs.integration.test.ts:64:27\n\n  61 readOnlyToken = await getAuthToken(readOnly.user.email, \"Test123!@#\", app);\n  62 \n  63 // Create some test audit logs\n→ 64 await prisma.auditLog.createMany(\nForeign key constraint violated: `audit_logs_tenant_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Audit Logs Integration Tests","GET /api/v1/audit-logs"],"fullName":" Audit Logs Integration Tests GET /api/v1/audit-logs should filter by user_id","status":"failed","title":"should filter by user_id","duration":10380,"failureMessages":["Failed to get auth token: E-posta veya şifre hatalı."],"location":{"line":260,"column":15}},{"ancestorTitles":["","Audit Logs Integration Tests","GET /api/v1/audit-logs"],"fullName":" Audit Logs Integration Tests GET /api/v1/audit-logs should filter by action","status":"failed","title":"should filter by action","duration":7983,"failureMessages":["Failed to get auth token: E-posta veya şifre hatalı."],"location":{"line":260,"column":15}},{"ancestorTitles":["","Audit Logs Integration Tests","GET /api/v1/audit-logs"],"fullName":" Audit Logs Integration Tests GET /api/v1/audit-logs should filter by resource_type","status":"failed","title":"should filter by resource_type","duration":9539,"failureMessages":["expected 200 \"OK\", got 401 \"Unauthorized\""],"location":{"line":172,"column":10}},{"ancestorTitles":["","Audit Logs Integration Tests","GET /api/v1/audit-logs"],"fullName":" Audit Logs Integration Tests GET /api/v1/audit-logs should support pagination","status":"passed","title":"should support pagination","duration":7420,"failureMessages":[]},{"ancestorTitles":["","Audit Logs Integration Tests","GET /api/v1/audit-logs"],"fullName":" Audit Logs Integration Tests GET /api/v1/audit-logs should include user information in response","status":"failed","title":"should include user information in response","duration":11450,"failureMessages":["Failed to get auth token: E-posta veya şifre hatalı."],"location":{"line":260,"column":15}},{"ancestorTitles":["","Audit Logs Integration Tests","Tenant Isolation"],"fullName":" Audit Logs Integration Tests Tenant Isolation should only return audit logs for current tenant","status":"failed","title":"should only return audit logs for current tenant","duration":8287,"failureMessages":["expected 200 \"OK\", got 401 \"Unauthorized\""],"location":{"line":240,"column":10}},{"ancestorTitles":["","Audit Logs Integration Tests","Tenant Isolation"],"fullName":" Audit Logs Integration Tests Tenant Isolation should not allow cross-tenant access","status":"failed","title":"should not allow cross-tenant access","duration":6732,"failureMessages":["expected 200 \"OK\", got 401 \"Unauthorized\""],"location":{"line":264,"column":10}}],"startTime":1765221262589,"endTime":1765221363715,"status":"failed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/audit-logs.integration.test.ts"},{"assertionResults":[{"ancestorTitles":["","Auth & Tenant Flow Integration Tests","POST /api/v1/auth/register"],"fullName":" Auth & Tenant Flow Integration Tests POST /api/v1/auth/register should create User, Tenant, and UserTenantMembership with TenantOwner role","status":"passed","title":"should create User, Tenant, and UserTenantMembership with TenantOwner role","duration":6965,"failureMessages":[]},{"ancestorTitles":["","Auth & Tenant Flow Integration Tests","POST /api/v1/auth/register"],"fullName":" Auth & Tenant Flow Integration Tests POST /api/v1/auth/register should fail with duplicate email","status":"passed","title":"should fail with duplicate email","duration":4477,"failureMessages":[]},{"ancestorTitles":["","Auth & Tenant Flow Integration Tests","POST /api/v1/auth/register"],"fullName":" Auth & Tenant Flow Integration Tests POST /api/v1/auth/register should fail with duplicate tenant slug","status":"passed","title":"should fail with duplicate tenant slug","duration":7929,"failureMessages":[]},{"ancestorTitles":["","Auth & Tenant Flow Integration Tests","POST /api/v1/auth/login"],"fullName":" Auth & Tenant Flow Integration Tests POST /api/v1/auth/login should succeed with correct credentials","status":"passed","title":"should succeed with correct credentials","duration":9857,"failureMessages":[]},{"ancestorTitles":["","Auth & Tenant Flow Integration Tests","POST /api/v1/auth/login"],"fullName":" Auth & Tenant Flow Integration Tests POST /api/v1/auth/login should fail with wrong password","status":"passed","title":"should fail with wrong password","duration":18777,"failureMessages":[]},{"ancestorTitles":["","Auth & Tenant Flow Integration Tests","POST /api/v1/auth/login"],"fullName":" Auth & Tenant Flow Integration Tests POST /api/v1/auth/login should fail with non-existent email","status":"passed","title":"should fail with non-existent email","duration":5567,"failureMessages":[]},{"ancestorTitles":["","Auth & Tenant Flow Integration Tests","Tenant Isolation"],"fullName":" Auth & Tenant Flow Integration Tests Tenant Isolation should prevent user from Tenant A accessing Tenant B's data","status":"failed","title":"should prevent user from Tenant A accessing Tenant B's data","duration":7468,"failureMessages":["\nInvalid `prisma.userTenantMembership.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/test-utils/test-auth.ts:130:52\n\n  127   });\n  128 } else {\n  129   // Create new membership\n→ 130   membership = await prisma.userTenantMembership.create(\nForeign key constraint violated: `user_tenant_memberships_tenant_id_fkey (index)`"],"location":{"line":121,"column":7315}}],"startTime":1765221197151,"endTime":1765221258195,"status":"failed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/auth-routes.integration.test.ts"},{"assertionResults":[{"ancestorTitles":["","Core Domain Integration Tests","Client Companies"],"fullName":" Core Domain Integration Tests Client Companies should create client company successfully","status":"passed","title":"should create client company successfully","duration":8276,"failureMessages":[]},{"ancestorTitles":["","Core Domain Integration Tests","Client Companies"],"fullName":" Core Domain Integration Tests Client Companies should fail on duplicate tax number within same tenant","status":"passed","title":"should fail on duplicate tax number within same tenant","duration":7173,"failureMessages":[]},{"ancestorTitles":["","Core Domain Integration Tests","Client Companies"],"fullName":" Core Domain Integration Tests Client Companies should filter companies by tenant_id","status":"passed","title":"should filter companies by tenant_id","duration":7491,"failureMessages":[]},{"ancestorTitles":["","Core Domain Integration Tests","Invoices"],"fullName":" Core Domain Integration Tests Invoices should create invoice with lines and totals match","status":"passed","title":"should create invoice with lines and totals match","duration":8220,"failureMessages":[]},{"ancestorTitles":["","Core Domain Integration Tests","Invoices"],"fullName":" Core Domain Integration Tests Invoices should list invoices filtered by tenant","status":"passed","title":"should list invoices filtered by tenant","duration":11779,"failureMessages":[]},{"ancestorTitles":["","Core Domain Integration Tests","Transactions"],"fullName":" Core Domain Integration Tests Transactions should create transaction with debit_total = credit_total","status":"passed","title":"should create transaction with debit_total = credit_total","duration":6413,"failureMessages":[]},{"ancestorTitles":["","Core Domain Integration Tests","Transactions"],"fullName":" Core Domain Integration Tests Transactions should fail if debit_total ≠ credit_total","status":"passed","title":"should fail if debit_total ≠ credit_total","duration":4344,"failureMessages":[]},{"ancestorTitles":["","Core Domain Integration Tests","Transactions"],"fullName":" Core Domain Integration Tests Transactions should filter transactions by tenant","status":"passed","title":"should filter transactions by tenant","duration":4797,"failureMessages":[]}],"startTime":1765221055822,"endTime":1765221114315,"status":"passed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/core-domain.integration.test.ts"},{"assertionResults":[{"ancestorTitles":["","Documents & Processing Integration Tests","POST /api/v1/documents/upload"],"fullName":" Documents & Processing Integration Tests POST /api/v1/documents/upload should create Document with status UPLOADED","status":"passed","title":"should create Document with status UPLOADED","duration":7042,"failureMessages":[]},{"ancestorTitles":["","Documents & Processing Integration Tests","Document Processing"],"fullName":" Documents & Processing Integration Tests Document Processing should process document and create OCR result, parsed data, and risk features","status":"passed","title":"should process document and create OCR result, parsed data, and risk features","duration":7765,"failureMessages":[]},{"ancestorTitles":["","Documents & Processing Integration Tests","Tenant Isolation"],"fullName":" Documents & Processing Integration Tests Tenant Isolation should prevent user from another tenant accessing document","status":"passed","title":"should prevent user from another tenant accessing document","duration":10315,"failureMessages":[]}],"startTime":1765221437505,"endTime":1765221462629,"status":"passed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/documents.integration.test.ts"},{"assertionResults":[{"ancestorTitles":["","Integrations & Sync Integration Tests","TenantIntegration with MockAccountingProvider"],"fullName":" Integrations & Sync Integration Tests TenantIntegration with MockAccountingProvider should create integration and test connection successfully","status":"passed","title":"should create integration and test connection successfully","duration":9052,"failureMessages":[]},{"ancestorTitles":["","Integrations & Sync Integration Tests","TenantIntegration with MockAccountingProvider"],"fullName":" Integrations & Sync Integration Tests TenantIntegration with MockAccountingProvider should create sync job and process it successfully","status":"failed","title":"should create sync job and process it successfully","duration":4575,"failureMessages":["expected 0 to be greater than 0"],"location":{"line":239,"column":31}},{"ancestorTitles":["","Integrations & Sync Integration Tests","TenantIntegration with MockBankProvider"],"fullName":" Integrations & Sync Integration Tests TenantIntegration with MockBankProvider should create bank integration and sync transactions","status":"passed","title":"should create bank integration and sync transactions","duration":4559,"failureMessages":[]},{"ancestorTitles":["","Integrations & Sync Integration Tests","Tenant Isolation"],"fullName":" Integrations & Sync Integration Tests Tenant Isolation should scope all integration data to correct tenant","status":"failed","title":"should scope all integration data to correct tenant","duration":5269,"failureMessages":["expected [] to include 'cmixj379j01uufx6dzjom16l4'"],"location":{"line":407,"column":30}}],"startTime":1765221115449,"endTime":1765221138905,"status":"failed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/integrations.integration.test.ts"},{"assertionResults":[{"ancestorTitles":["","Notifications Integration Tests","GET /api/v1/notifications"],"fullName":" Notifications Integration Tests GET /api/v1/notifications should return notifications for current tenant and user","status":"failed","title":"should return notifications for current tenant and user","duration":9744,"failureMessages":["\nInvalid `prisma.userTenantMembership.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/test-utils/test-auth.ts:130:52\n\n  127   });\n  128 } else {\n  129   // Create new membership\n→ 130   membership = await prisma.userTenantMembership.create(\nForeign key constraint violated: `user_tenant_memberships_tenant_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Notifications Integration Tests","GET /api/v1/notifications"],"fullName":" Notifications Integration Tests GET /api/v1/notifications should return tenant-wide notifications (userId = null)","status":"passed","title":"should return tenant-wide notifications (userId = null)","duration":7117,"failureMessages":[]},{"ancestorTitles":["","Notifications Integration Tests","GET /api/v1/notifications"],"fullName":" Notifications Integration Tests GET /api/v1/notifications should NOT return notifications from another tenant","status":"passed","title":"should NOT return notifications from another tenant","duration":8357,"failureMessages":[]},{"ancestorTitles":["","Notifications Integration Tests","GET /api/v1/notifications"],"fullName":" Notifications Integration Tests GET /api/v1/notifications should filter by is_read","status":"failed","title":"should filter by is_read","duration":7156,"failureMessages":["\nInvalid `prisma.notification.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/notifications.integration.test.ts:128:33\n\n  125 await prisma.$queryRaw`SELECT 1`;\n  126 \n  127 // Create read and unread notifications\n→ 128 await prisma.notification.create(\nForeign key constraint violated: `notifications_user_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Notifications Integration Tests","GET /api/v1/notifications"],"fullName":" Notifications Integration Tests GET /api/v1/notifications should filter by type","status":"failed","title":"should filter by type","duration":9869,"failureMessages":["\nInvalid `prisma.notification.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/notifications.integration.test.ts:167:33\n\n  164 // Ensure tenant is committed\n  165 await prisma.$queryRaw`SELECT 1`;\n  166 \n→ 167 await prisma.notification.create(\nForeign key constraint violated: `notifications_user_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Notifications Integration Tests","GET /api/v1/notifications"],"fullName":" Notifications Integration Tests GET /api/v1/notifications should support pagination","status":"failed","title":"should support pagination","duration":6829,"failureMessages":["\nInvalid `prisma.notification.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/notifications.integration.test.ts:206:35\n\n  203 \n  204 // Create multiple notifications\n  205 for (let i = 0; i < 5; i++) {\n→ 206   await prisma.notification.create(\nForeign key constraint violated: `notifications_user_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Notifications Integration Tests","POST /api/v1/notifications/:id/read"],"fullName":" Notifications Integration Tests POST /api/v1/notifications/:id/read should mark notification as read","status":"failed","title":"should mark notification as read","duration":5504,"failureMessages":["\nInvalid `prisma.notification.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/notifications.integration.test.ts:237:54\n\n  234 // Ensure tenant is committed\n  235 await prisma.$queryRaw`SELECT 1`;\n  236 \n→ 237 const notification = await prisma.notification.create(\nForeign key constraint violated: `notifications_user_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Notifications Integration Tests","POST /api/v1/notifications/:id/read"],"fullName":" Notifications Integration Tests POST /api/v1/notifications/:id/read should return 404 when notification not found","status":"failed","title":"should return 404 when notification not found","duration":7235,"failureMessages":["Failed to get auth token: E-posta veya şifre hatalı."],"location":{"line":260,"column":15}},{"ancestorTitles":["","Notifications Integration Tests","POST /api/v1/notifications/:id/read"],"fullName":" Notifications Integration Tests POST /api/v1/notifications/:id/read should return 404 when user from another tenant tries to mark notification","status":"failed","title":"should return 404 when user from another tenant tries to mark notification","duration":8018,"failureMessages":["\nInvalid `prisma.notification.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/notifications.integration.test.ts:285:54\n\n  282 // Ensure tenants are committed\n  283 await prisma.$queryRaw`SELECT 1`;\n  284 \n→ 285 const notification = await prisma.notification.create(\nForeign key constraint violated: `notifications_user_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Notifications Integration Tests","POST /api/v1/notifications/read-all"],"fullName":" Notifications Integration Tests POST /api/v1/notifications/read-all should mark all user's notifications as read","status":"failed","title":"should mark all user's notifications as read","duration":8511,"failureMessages":["\nInvalid `prisma.notification.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/notifications.integration.test.ts:315:35\n\n  312 \n  313 // Create multiple unread notifications\n  314 for (let i = 0; i < 3; i++) {\n→ 315   await prisma.notification.create(\nForeign key constraint violated: `notifications_user_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Notifications Integration Tests","POST /api/v1/notifications/read-all"],"fullName":" Notifications Integration Tests POST /api/v1/notifications/read-all should only mark notifications for current user in current tenant","status":"passed","title":"should only mark notifications for current user in current tenant","duration":7566,"failureMessages":[]},{"ancestorTitles":["","Notifications Integration Tests","Tenant Isolation"],"fullName":" Notifications Integration Tests Tenant Isolation should prevent user from Tenant A reading notifications of Tenant B","status":"failed","title":"should prevent user from Tenant A reading notifications of Tenant B","duration":12161,"failureMessages":["\nInvalid `prisma.notification.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/notifications.integration.test.ts:412:54\n\n  409 await prisma.$queryRaw`SELECT 1`;\n  410 \n  411 // Create notification in Tenant B\n→ 412 const notification = await prisma.notification.create(\nForeign key constraint violated: `notifications_tenant_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Notifications Integration Tests","Tenant Isolation"],"fullName":" Notifications Integration Tests Tenant Isolation should enforce tenant_id in all queries","status":"passed","title":"should enforce tenant_id in all queries","duration":7704,"failureMessages":[]},{"ancestorTitles":["","Notifications Integration Tests","Event Integration"],"fullName":" Notifications Integration Tests Event Integration should create notification when risk alert is created","status":"failed","title":"should create notification when risk alert is created","duration":7304,"failureMessages":["\nInvalid `prisma.clientCompany.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/notifications.integration.test.ts:487:56\n\n  484 // We'll need to import the service and create a risk alert\n  485 const { riskAlertService } = await import(\"../../services/risk-alert-service\");\n  486 \n→ 487 const clientCompany = await prisma.clientCompany.create(\nForeign key constraint violated: `client_companies_tenant_id_fkey (index)`"],"location":{"line":121,"column":7315}}],"startTime":1765220993414,"endTime":1765221106498,"status":"failed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/notifications.integration.test.ts"},{"assertionResults":[{"ancestorTitles":["","RBAC Integration Tests","POST /api/v1/tenants/:tenantId/users/invite"],"fullName":" RBAC Integration Tests POST /api/v1/tenants/:tenantId/users/invite should allow TenantOwner to invite users","status":"passed","title":"should allow TenantOwner to invite users","duration":8919,"failureMessages":[]},{"ancestorTitles":["","RBAC Integration Tests","POST /api/v1/tenants/:tenantId/users/invite"],"fullName":" RBAC Integration Tests POST /api/v1/tenants/:tenantId/users/invite should allow Accountant to invite users","status":"passed","title":"should allow Accountant to invite users","duration":12610,"failureMessages":[]},{"ancestorTitles":["","RBAC Integration Tests","POST /api/v1/tenants/:tenantId/users/invite"],"fullName":" RBAC Integration Tests POST /api/v1/tenants/:tenantId/users/invite should deny ReadOnly user from inviting users","status":"passed","title":"should deny ReadOnly user from inviting users","duration":10363,"failureMessages":[]},{"ancestorTitles":["","RBAC Integration Tests","POST /api/v1/tenants/:tenantId/users/invite"],"fullName":" RBAC Integration Tests POST /api/v1/tenants/:tenantId/users/invite should deny Staff user from inviting users","status":"passed","title":"should deny Staff user from inviting users","duration":10207,"failureMessages":[]},{"ancestorTitles":["","RBAC Integration Tests","GET /api/v1/tenants/:tenantId/users"],"fullName":" RBAC Integration Tests GET /api/v1/tenants/:tenantId/users should allow all roles to read users list","status":"passed","title":"should allow all roles to read users list","duration":12509,"failureMessages":[]},{"ancestorTitles":["","RBAC Integration Tests","Document operations"],"fullName":" RBAC Integration Tests Document operations should allow TenantOwner to create documents","status":"passed","title":"should allow TenantOwner to create documents","duration":7969,"failureMessages":[]},{"ancestorTitles":["","RBAC Integration Tests","Document operations"],"fullName":" RBAC Integration Tests Document operations should deny ReadOnly user from creating documents","status":"passed","title":"should deny ReadOnly user from creating documents","duration":9288,"failureMessages":[]}],"startTime":1765221383151,"endTime":1765221455022,"status":"passed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/rbac.integration.test.ts"},{"assertionResults":[{"ancestorTitles":["","Report Download Routes Integration Tests","PDF Export"],"fullName":" Report Download Routes Integration Tests PDF Export should export COMPANY_FINANCIAL_SUMMARY as PDF with valid structure","status":"failed","title":"should export COMPANY_FINANCIAL_SUMMARY as PDF with valid structure","duration":9756,"failureMessages":["Failed to get auth token: E-posta veya şifre hatalı."],"location":{"line":260,"column":15}},{"ancestorTitles":["","Report Download Routes Integration Tests","PDF Export"],"fullName":" Report Download Routes Integration Tests PDF Export should export COMPANY_RISK_SUMMARY as PDF","status":"passed","title":"should export COMPANY_RISK_SUMMARY as PDF","duration":7154,"failureMessages":[]},{"ancestorTitles":["","Report Download Routes Integration Tests","PDF Export"],"fullName":" Report Download Routes Integration Tests PDF Export should export TENANT_PORTFOLIO as PDF","status":"passed","title":"should export TENANT_PORTFOLIO as PDF","duration":7313,"failureMessages":[]},{"ancestorTitles":["","Report Download Routes Integration Tests","PDF Export"],"fullName":" Report Download Routes Integration Tests PDF Export should export DOCUMENT_ACTIVITY as PDF","status":"passed","title":"should export DOCUMENT_ACTIVITY as PDF","duration":6727,"failureMessages":[]},{"ancestorTitles":["","Report Download Routes Integration Tests","Excel/CSV Export"],"fullName":" Report Download Routes Integration Tests Excel/CSV Export should export COMPANY_FINANCIAL_SUMMARY as CSV with valid structure and headers","status":"passed","title":"should export COMPANY_FINANCIAL_SUMMARY as CSV with valid structure and headers","duration":7978,"failureMessages":[]},{"ancestorTitles":["","Report Download Routes Integration Tests","Excel/CSV Export"],"fullName":" Report Download Routes Integration Tests Excel/CSV Export should export TENANT_PORTFOLIO as CSV with headers matching report columns","status":"passed","title":"should export TENANT_PORTFOLIO as CSV with headers matching report columns","duration":9874,"failureMessages":[]},{"ancestorTitles":["","Report Download Routes Integration Tests","RBAC"],"fullName":" Report Download Routes Integration Tests RBAC should allow TenantOwner to download reports","status":"passed","title":"should allow TenantOwner to download reports","duration":9055,"failureMessages":[]},{"ancestorTitles":["","Report Download Routes Integration Tests","RBAC"],"fullName":" Report Download Routes Integration Tests RBAC should allow Accountant to download reports","status":"passed","title":"should allow Accountant to download reports","duration":7533,"failureMessages":[]},{"ancestorTitles":["","Report Download Routes Integration Tests","RBAC"],"fullName":" Report Download Routes Integration Tests RBAC should allow Staff to download reports","status":"failed","title":"should allow Staff to download reports","duration":5630,"failureMessages":["expected 200 \"OK\", got 401 \"Unauthorized\""],"location":{"line":455,"column":10}},{"ancestorTitles":["","Report Download Routes Integration Tests","RBAC"],"fullName":" Report Download Routes Integration Tests RBAC should allow ReadOnly to download reports","status":"passed","title":"should allow ReadOnly to download reports","duration":6625,"failureMessages":[]},{"ancestorTitles":["","Report Download Routes Integration Tests","Tenant Isolation"],"fullName":" Report Download Routes Integration Tests Tenant Isolation should prevent cross-tenant report downloads","status":"passed","title":"should prevent cross-tenant report downloads","duration":4696,"failureMessages":[]},{"ancestorTitles":["","Report Download Routes Integration Tests","Error Cases"],"fullName":" Report Download Routes Integration Tests Error Cases should return 400 for invalid format","status":"failed","title":"should return 400 for invalid format","duration":5202,"failureMessages":["\nInvalid `prisma.tenant.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/test-utils/test-auth.ts:80:34\n\n  77     await new Promise(resolve => setTimeout(resolve, 50));\n  78   }\n  79 } else {\n→ 80   tenant = await prisma.tenant.create(\nUnique constraint failed on the fields: (`slug`)"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Report Download Routes Integration Tests","Error Cases"],"fullName":" Report Download Routes Integration Tests Error Cases should return 400 for invalid report_code","status":"passed","title":"should return 400 for invalid report_code","duration":6115,"failureMessages":[]},{"ancestorTitles":["","Report Download Routes Integration Tests","Error Cases"],"fullName":" Report Download Routes Integration Tests Error Cases should return 400 for missing required client_company_id","status":"failed","title":"should return 400 for missing required client_company_id","duration":6716,"failureMessages":["expected 'Bu rapor için müşteri şirket seçilmesi zorunludur.' to contain 'Müşteri şirketi ID\\'si gerekli'"],"location":{"line":588,"column":43}}],"startTime":1765220852050,"endTime":1765220952428,"status":"failed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/report-download.integration.test.ts"},{"assertionResults":[{"ancestorTitles":["","Report Execution Logs Routes Integration Tests","GET /api/v1/report-execution-logs"],"fullName":" Report Execution Logs Routes Integration Tests GET /api/v1/report-execution-logs should return execution logs for tenant","status":"failed","title":"should return execution logs for tenant","duration":4940,"failureMessages":["\nInvalid `prisma.scheduledReport.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/report-execution-logs.integration.test.ts:87:58\n\n  84 }\n  85 \n  86 // Create a scheduled report for testUser\n→ 87 const scheduledReport = await prisma.scheduledReport.create(\nForeign key constraint violated: `scheduled_reports_tenant_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Report Execution Logs Routes Integration Tests","GET /api/v1/report-execution-logs"],"fullName":" Report Execution Logs Routes Integration Tests GET /api/v1/report-execution-logs should respect limit query parameter","status":"passed","title":"should respect limit query parameter","duration":5785,"failureMessages":[]},{"ancestorTitles":["","Report Execution Logs Routes Integration Tests","GET /api/v1/report-execution-logs"],"fullName":" Report Execution Logs Routes Integration Tests GET /api/v1/report-execution-logs should allow all roles to read logs","status":"failed","title":"should allow all roles to read logs","duration":4670,"failureMessages":["\nInvalid `prisma.scheduledReport.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/report-execution-logs.integration.test.ts:87:58\n\n  84 }\n  85 \n  86 // Create a scheduled report for testUser\n→ 87 const scheduledReport = await prisma.scheduledReport.create(\nForeign key constraint violated: `scheduled_reports_tenant_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Report Execution Logs Routes Integration Tests","GET /api/v1/report-execution-logs/scheduled/:scheduledReportId"],"fullName":" Report Execution Logs Routes Integration Tests GET /api/v1/report-execution-logs/scheduled/:scheduledReportId should return execution logs for specific scheduled report","status":"passed","title":"should return execution logs for specific scheduled report","duration":3914,"failureMessages":[]},{"ancestorTitles":["","Report Execution Logs Routes Integration Tests","GET /api/v1/report-execution-logs/scheduled/:scheduledReportId"],"fullName":" Report Execution Logs Routes Integration Tests GET /api/v1/report-execution-logs/scheduled/:scheduledReportId should return 404 for scheduled report from different tenant","status":"failed","title":"should return 404 for scheduled report from different tenant","duration":8206,"failureMessages":["expected 404 \"Not Found\", got 401 \"Unauthorized\""],"location":{"line":230,"column":10}},{"ancestorTitles":["","Report Execution Logs Routes Integration Tests","Tenant Isolation"],"fullName":" Report Execution Logs Routes Integration Tests Tenant Isolation should only return logs for current tenant","status":"failed","title":"should only return logs for current tenant","duration":8508,"failureMessages":["expected 200 \"OK\", got 401 \"Unauthorized\""],"location":{"line":268,"column":10}}],"startTime":1765221298650,"endTime":1765221334674,"status":"failed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/report-execution-logs.integration.test.ts"},{"assertionResults":[{"ancestorTitles":["","Reporting RBAC Tests","Report Generation RBAC"],"fullName":" Reporting RBAC Tests Report Generation RBAC should allow TenantOwner to generate on-demand reports","status":"passed","title":"should allow TenantOwner to generate on-demand reports","duration":46705,"failureMessages":[]},{"ancestorTitles":["","Reporting RBAC Tests","Report Generation RBAC"],"fullName":" Reporting RBAC Tests Report Generation RBAC should allow Accountant to generate on-demand reports","status":"passed","title":"should allow Accountant to generate on-demand reports","duration":37970,"failureMessages":[]},{"ancestorTitles":["","Reporting RBAC Tests","Report Generation RBAC"],"fullName":" Reporting RBAC Tests Report Generation RBAC should allow Staff to generate on-demand reports","status":"passed","title":"should allow Staff to generate on-demand reports","duration":36183,"failureMessages":[]},{"ancestorTitles":["","Reporting RBAC Tests","Report Generation RBAC"],"fullName":" Reporting RBAC Tests Report Generation RBAC should allow ReadOnly to generate on-demand reports","status":"passed","title":"should allow ReadOnly to generate on-demand reports","duration":24903,"failureMessages":[]},{"ancestorTitles":["","Reporting RBAC Tests","Report Download RBAC"],"fullName":" Reporting RBAC Tests Report Download RBAC should allow TenantOwner to download reports","status":"passed","title":"should allow TenantOwner to download reports","duration":23165,"failureMessages":[]},{"ancestorTitles":["","Reporting RBAC Tests","Report Download RBAC"],"fullName":" Reporting RBAC Tests Report Download RBAC should allow Accountant to download reports","status":"passed","title":"should allow Accountant to download reports","duration":31137,"failureMessages":[]},{"ancestorTitles":["","Reporting RBAC Tests","Report Download RBAC"],"fullName":" Reporting RBAC Tests Report Download RBAC should allow Staff to download reports","status":"passed","title":"should allow Staff to download reports","duration":25869,"failureMessages":[]},{"ancestorTitles":["","Reporting RBAC Tests","Report Download RBAC"],"fullName":" Reporting RBAC Tests Report Download RBAC should allow ReadOnly to download reports","status":"passed","title":"should allow ReadOnly to download reports","duration":20229,"failureMessages":[]},{"ancestorTitles":["","Reporting RBAC Tests","Scheduled Reports RBAC"],"fullName":" Reporting RBAC Tests Scheduled Reports RBAC should allow TenantOwner to create scheduled reports","status":"failed","title":"should allow TenantOwner to create scheduled reports","duration":19962,"failureMessages":["expected 201 \"Created\", got 500 \"Internal Server Error\""],"location":{"line":430,"column":10}},{"ancestorTitles":["","Reporting RBAC Tests","Scheduled Reports RBAC"],"fullName":" Reporting RBAC Tests Scheduled Reports RBAC should allow Accountant to create scheduled reports","status":"failed","title":"should allow Accountant to create scheduled reports","duration":24493,"failureMessages":["expected 201 \"Created\", got 500 \"Internal Server Error\""],"location":{"line":480,"column":10}},{"ancestorTitles":["","Reporting RBAC Tests","Scheduled Reports RBAC"],"fullName":" Reporting RBAC Tests Scheduled Reports RBAC should prevent Staff from creating scheduled reports (403)","status":"passed","title":"should prevent Staff from creating scheduled reports (403)","duration":16088,"failureMessages":[]},{"ancestorTitles":["","Reporting RBAC Tests","Scheduled Reports RBAC"],"fullName":" Reporting RBAC Tests Scheduled Reports RBAC should prevent ReadOnly from creating scheduled reports (403)","status":"passed","title":"should prevent ReadOnly from creating scheduled reports (403)","duration":17455,"failureMessages":[]},{"ancestorTitles":["","Reporting RBAC Tests","Scheduled Reports RBAC"],"fullName":" Reporting RBAC Tests Scheduled Reports RBAC should allow TenantOwner to update scheduled reports","status":"failed","title":"should allow TenantOwner to update scheduled reports","duration":20206,"failureMessages":["expected 201 \"Created\", got 500 \"Internal Server Error\""],"location":{"line":601,"column":10}},{"ancestorTitles":["","Reporting RBAC Tests","Scheduled Reports RBAC"],"fullName":" Reporting RBAC Tests Scheduled Reports RBAC should allow Accountant to update scheduled reports","status":"failed","title":"should allow Accountant to update scheduled reports","duration":21962,"failureMessages":["expected 201 \"Created\", got 500 \"Internal Server Error\""],"location":{"line":663,"column":10}},{"ancestorTitles":["","Reporting RBAC Tests","Scheduled Reports RBAC"],"fullName":" Reporting RBAC Tests Scheduled Reports RBAC should prevent Staff from updating scheduled reports (403)","status":"failed","title":"should prevent Staff from updating scheduled reports (403)","duration":18121,"failureMessages":["expected 201 \"Created\", got 500 \"Internal Server Error\""],"location":{"line":698,"column":10}},{"ancestorTitles":["","Reporting RBAC Tests","Scheduled Reports RBAC"],"fullName":" Reporting RBAC Tests Scheduled Reports RBAC should prevent ReadOnly from updating scheduled reports (403)","status":"failed","title":"should prevent ReadOnly from updating scheduled reports (403)","duration":16347,"failureMessages":["expected 201 \"Created\", got 500 \"Internal Server Error\""],"location":{"line":761,"column":10}},{"ancestorTitles":["","Reporting RBAC Tests","Scheduled Reports RBAC"],"fullName":" Reporting RBAC Tests Scheduled Reports RBAC should allow TenantOwner to delete scheduled reports","status":"failed","title":"should allow TenantOwner to delete scheduled reports","duration":15086,"failureMessages":["expected 201 \"Created\", got 500 \"Internal Server Error\""],"location":{"line":824,"column":10}},{"ancestorTitles":["","Reporting RBAC Tests","Scheduled Reports RBAC"],"fullName":" Reporting RBAC Tests Scheduled Reports RBAC should prevent Staff from deleting scheduled reports (403)","status":"failed","title":"should prevent Staff from deleting scheduled reports (403)","duration":17379,"failureMessages":["expected 201 \"Created\", got 500 \"Internal Server Error\""],"location":{"line":861,"column":10}},{"ancestorTitles":["","Reporting RBAC Tests","Scheduled Reports RBAC"],"fullName":" Reporting RBAC Tests Scheduled Reports RBAC should prevent ReadOnly from deleting scheduled reports (403)","status":"failed","title":"should prevent ReadOnly from deleting scheduled reports (403)","duration":12042,"failureMessages":["expected 201 \"Created\", got 500 \"Internal Server Error\""],"location":{"line":921,"column":10}}],"startTime":1765220275486,"endTime":1765220720805,"status":"failed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/reporting-rbac.test.ts"},{"assertionResults":[{"ancestorTitles":["","Reporting Routes Integration Tests","GET /api/v1/reports/definitions"],"fullName":" Reporting Routes Integration Tests GET /api/v1/reports/definitions should return 200 with active definitions","status":"passed","title":"should return 200 with active definitions","duration":44861,"failureMessages":[]},{"ancestorTitles":["","Reporting Routes Integration Tests","GET /api/v1/reports/definitions"],"fullName":" Reporting Routes Integration Tests GET /api/v1/reports/definitions should respect RBAC","status":"failed","title":"should respect RBAC","duration":39284,"failureMessages":["Failed to get auth token: E-posta veya şifre hatalı."],"location":{"line":260,"column":15}},{"ancestorTitles":["","Reporting Routes Integration Tests","POST /api/v1/reports/generate"],"fullName":" Reporting Routes Integration Tests POST /api/v1/reports/generate should generate COMPANY_FINANCIAL_SUMMARY report with detailed assertions","status":"failed","title":"should generate COMPANY_FINANCIAL_SUMMARY report with detailed assertions","duration":29991,"failureMessages":["\nInvalid `prisma.userTenantMembership.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/test-utils/test-auth.ts:130:52\n\n  127   });\n  128 } else {\n  129   // Create new membership\n→ 130   membership = await prisma.userTenantMembership.create(\nForeign key constraint violated: `user_tenant_memberships_user_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Reporting Routes Integration Tests","POST /api/v1/reports/generate"],"fullName":" Reporting Routes Integration Tests POST /api/v1/reports/generate should generate COMPANY_RISK_SUMMARY report with detailed assertions","status":"failed","title":"should generate COMPANY_RISK_SUMMARY report with detailed assertions","duration":28350,"failureMessages":["User cmixinp5e0035fx6d0mrxxwst not found. Create user before creating document."],"location":{"line":245,"column":13}},{"ancestorTitles":["","Reporting Routes Integration Tests","POST /api/v1/reports/generate"],"fullName":" Reporting Routes Integration Tests POST /api/v1/reports/generate should generate TENANT_PORTFOLIO report with detailed assertions","status":"failed","title":"should generate TENANT_PORTFOLIO report with detailed assertions","duration":22165,"failureMessages":["expected 200 \"OK\", got 401 \"Unauthorized\""],"location":{"line":488,"column":10}},{"ancestorTitles":["","Reporting Routes Integration Tests","POST /api/v1/reports/generate"],"fullName":" Reporting Routes Integration Tests POST /api/v1/reports/generate should generate DOCUMENT_ACTIVITY report with detailed assertions","status":"failed","title":"should generate DOCUMENT_ACTIVITY report with detailed assertions","duration":27137,"failureMessages":["expected 200 \"OK\", got 401 \"Unauthorized\""],"location":{"line":577,"column":10}},{"ancestorTitles":["","Reporting Routes Integration Tests","POST /api/v1/reports/generate"],"fullName":" Reporting Routes Integration Tests POST /api/v1/reports/generate should return 400 for invalid report_code","status":"failed","title":"should return 400 for invalid report_code","duration":28613,"failureMessages":["expected 'Geçersiz rapor türü.' to contain 'Geçersiz rapor kodu'"],"location":{"line":640,"column":43}},{"ancestorTitles":["","Reporting Routes Integration Tests","POST /api/v1/reports/generate"],"fullName":" Reporting Routes Integration Tests POST /api/v1/reports/generate should return 400 for missing required client_company_id","status":"failed","title":"should return 400 for missing required client_company_id","duration":22063,"failureMessages":["User cmixiptrj008afx6d38ytukvu not found. Create user before creating document."],"location":{"line":245,"column":13}},{"ancestorTitles":["","Reporting Routes Integration Tests","POST /api/v1/reports/generate"],"fullName":" Reporting Routes Integration Tests POST /api/v1/reports/generate should handle no data scenario gracefully (empty rows, no crash)","status":"passed","title":"should handle no data scenario gracefully (empty rows, no crash)","duration":23361,"failureMessages":[]},{"ancestorTitles":["","Reporting Routes Integration Tests","POST /api/v1/reports/generate"],"fullName":" Reporting Routes Integration Tests POST /api/v1/reports/generate should return 400 for missing filters","status":"failed","title":"should return 400 for missing filters","duration":53214,"failureMessages":["Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\"."]},{"ancestorTitles":["","Reporting Routes Integration Tests","POST /api/v1/reports/generate"],"fullName":" Reporting Routes Integration Tests POST /api/v1/reports/generate should return 400 for missing date range","status":"failed","title":"should return 400 for missing date range","duration":18723,"failureMessages":["expected 400 \"Bad Request\", got 401 \"Unauthorized\""],"location":{"line":716,"column":10}},{"ancestorTitles":["","Reporting Routes Integration Tests","POST /api/v1/reports/generate"],"fullName":" Reporting Routes Integration Tests POST /api/v1/reports/generate should return 400 for invalid date range (start > end)","status":"failed","title":"should return 400 for invalid date range (start > end)","duration":28495,"failureMessages":["Failed to get auth token: E-posta veya şifre hatalı."],"location":{"line":260,"column":15}},{"ancestorTitles":["","Reporting Routes Integration Tests","POST /api/v1/reports/generate"],"fullName":" Reporting Routes Integration Tests POST /api/v1/reports/generate should return 400 for overwide date range (>5 years)","status":"passed","title":"should return 400 for overwide date range (>5 years)","duration":18561,"failureMessages":[]},{"ancestorTitles":["","Reporting Routes Integration Tests","POST /api/v1/reports/generate"],"fullName":" Reporting Routes Integration Tests POST /api/v1/reports/generate should return 400 for invalid report_code","status":"passed","title":"should return 400 for invalid report_code","duration":19151,"failureMessages":[]},{"ancestorTitles":["","Reporting Routes Integration Tests","POST /api/v1/reports/generate"],"fullName":" Reporting Routes Integration Tests POST /api/v1/reports/generate should return 400 for missing client_company_id for company reports","status":"passed","title":"should return 400 for missing client_company_id for company reports","duration":14525,"failureMessages":[]},{"ancestorTitles":["","Reporting Routes Integration Tests","POST /api/v1/reports/generate"],"fullName":" Reporting Routes Integration Tests POST /api/v1/reports/generate should return 400 for invalid date format in filters","status":"failed","title":"should return 400 for invalid date format in filters","duration":46458,"failureMessages":["Test timed out in 30000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\"."]},{"ancestorTitles":["","Reporting Routes Integration Tests","POST /api/v1/reports/generate"],"fullName":" Reporting Routes Integration Tests POST /api/v1/reports/generate should return 404 for company not in tenant","status":"passed","title":"should return 404 for company not in tenant","duration":18163,"failureMessages":[]},{"ancestorTitles":["","Reporting Routes Integration Tests","POST /api/v1/reports/generate"],"fullName":" Reporting Routes Integration Tests POST /api/v1/reports/generate should return empty rows and default totals when no data","status":"passed","title":"should return empty rows and default totals when no data","duration":15851,"failureMessages":[]},{"ancestorTitles":["","Reporting Routes Integration Tests","POST /api/v1/reports/generate"],"fullName":" Reporting Routes Integration Tests POST /api/v1/reports/generate should apply limit and return meta information","status":"passed","title":"should apply limit and return meta information","duration":15313,"failureMessages":[]},{"ancestorTitles":["","Reporting Routes Integration Tests","Tenant Isolation"],"fullName":" Reporting Routes Integration Tests Tenant Isolation should prevent cross-tenant data access","status":"passed","title":"should prevent cross-tenant data access","duration":13132,"failureMessages":[]},{"ancestorTitles":["","Reporting Routes Integration Tests","RBAC"],"fullName":" Reporting Routes Integration Tests RBAC should allow TenantOwner to generate reports","status":"passed","title":"should allow TenantOwner to generate reports","duration":14465,"failureMessages":[]},{"ancestorTitles":["","Reporting Routes Integration Tests","RBAC"],"fullName":" Reporting Routes Integration Tests RBAC should allow Accountant to generate reports","status":"passed","title":"should allow Accountant to generate reports","duration":9055,"failureMessages":[]},{"ancestorTitles":["","Reporting Routes Integration Tests","RBAC"],"fullName":" Reporting Routes Integration Tests RBAC should allow Staff to generate reports","status":"passed","title":"should allow Staff to generate reports","duration":12323,"failureMessages":[]},{"ancestorTitles":["","Reporting Routes Integration Tests","RBAC"],"fullName":" Reporting Routes Integration Tests RBAC should allow ReadOnly to generate reports","status":"failed","title":"should allow ReadOnly to generate reports","duration":11582,"failureMessages":["expected 200 \"OK\", got 401 \"Unauthorized\""],"location":{"line":1055,"column":10}}],"startTime":1765220275485,"endTime":1765220850339,"status":"failed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/reporting-routes.integration.test.ts"},{"assertionResults":[{"ancestorTitles":["","Reporting Tenant Isolation Tests","Report Generation Tenant Isolation"],"fullName":" Reporting Tenant Isolation Tests Report Generation Tenant Isolation should prevent Tenant A from generating reports with Tenant B's client_company_id","status":"failed","title":"should prevent Tenant A from generating reports with Tenant B's client_company_id","duration":18045,"failureMessages":["expected 404 \"Not Found\", got 401 \"Unauthorized\""],"location":{"line":176,"column":10}},{"ancestorTitles":["","Reporting Tenant Isolation Tests","Report Generation Tenant Isolation"],"fullName":" Reporting Tenant Isolation Tests Report Generation Tenant Isolation should verify no data leakage between tenants in reports","status":"failed","title":"should verify no data leakage between tenants in reports","duration":13904,"failureMessages":["expected 200 \"OK\", got 401 \"Unauthorized\""],"location":{"line":196,"column":10}},{"ancestorTitles":["","Reporting Tenant Isolation Tests","Report Generation Tenant Isolation"],"fullName":" Reporting Tenant Isolation Tests Report Generation Tenant Isolation should prevent Tenant A from accessing Tenant B's portfolio data","status":"failed","title":"should prevent Tenant A from accessing Tenant B's portfolio data","duration":11637,"failureMessages":["\nInvalid `prisma.invoiceLine.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/test-utils/test-factories.ts:120:35\n\n  117   lineTotal = 100,\n  118 } = data;\n  119 \n→ 120 return await prisma.invoiceLine.create(\nForeign key constraint violated: `invoice_lines_invoice_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Reporting Tenant Isolation Tests","Scheduled Reports Tenant Isolation"],"fullName":" Reporting Tenant Isolation Tests Scheduled Reports Tenant Isolation should prevent Tenant A from reading Tenant B's ScheduledReport rows","status":"failed","title":"should prevent Tenant A from reading Tenant B's ScheduledReport rows","duration":10165,"failureMessages":["expected 200 \"OK\", got 401 \"Unauthorized\""],"location":{"line":273,"column":10}},{"ancestorTitles":["","Reporting Tenant Isolation Tests","Scheduled Reports Tenant Isolation"],"fullName":" Reporting Tenant Isolation Tests Scheduled Reports Tenant Isolation should prevent Tenant A from updating Tenant B's ScheduledReport","status":"failed","title":"should prevent Tenant A from updating Tenant B's ScheduledReport","duration":10601,"failureMessages":["Failed to get auth token: E-posta veya şifre hatalı."],"location":{"line":260,"column":15}},{"ancestorTitles":["","Reporting Tenant Isolation Tests","Scheduled Reports Tenant Isolation"],"fullName":" Reporting Tenant Isolation Tests Scheduled Reports Tenant Isolation should prevent Tenant A from deleting Tenant B's ScheduledReport","status":"failed","title":"should prevent Tenant A from deleting Tenant B's ScheduledReport","duration":8531,"failureMessages":["expected 404 \"Not Found\", got 401 \"Unauthorized\""],"location":{"line":343,"column":10}},{"ancestorTitles":["","Reporting Tenant Isolation Tests","Scheduled Reports Tenant Isolation"],"fullName":" Reporting Tenant Isolation Tests Scheduled Reports Tenant Isolation should prevent Tenant A from seeing Tenant B's ReportExecutionLogs","status":"failed","title":"should prevent Tenant A from seeing Tenant B's ReportExecutionLogs","duration":9131,"failureMessages":["expected 404 \"Not Found\", got 401 \"Unauthorized\""],"location":{"line":392,"column":10}},{"ancestorTitles":["","Reporting Tenant Isolation Tests","Cross-Tenant Data Access Prevention"],"fullName":" Reporting Tenant Isolation Tests Cross-Tenant Data Access Prevention should verify all report queries are tenant-scoped","status":"failed","title":"should verify all report queries are tenant-scoped","duration":6486,"failureMessages":["expected 200 \"OK\", got 401 \"Unauthorized\""],"location":{"line":415,"column":10}},{"ancestorTitles":["","Reporting Tenant Isolation Tests","Cross-Tenant Data Access Prevention"],"fullName":" Reporting Tenant Isolation Tests Cross-Tenant Data Access Prevention should verify scheduled report queries are tenant-scoped","status":"failed","title":"should verify scheduled report queries are tenant-scoped","duration":5207,"failureMessages":["expected 200 \"OK\", got 401 \"Unauthorized\""],"location":{"line":465,"column":10}},{"ancestorTitles":["","Reporting Tenant Isolation Tests","Cross-Tenant Data Access Prevention"],"fullName":" Reporting Tenant Isolation Tests Cross-Tenant Data Access Prevention should verify execution log queries are tenant-scoped","status":"passed","title":"should verify execution log queries are tenant-scoped","duration":4594,"failureMessages":[]}],"startTime":1765220955891,"endTime":1765221054197,"status":"failed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/reporting-tenant-isolation.test.ts"},{"assertionResults":[{"ancestorTitles":["","Scheduled Reports Routes Integration Tests","POST /api/v1/scheduled-reports"],"fullName":" Scheduled Reports Routes Integration Tests POST /api/v1/scheduled-reports should allow TenantOwner to create scheduled report","status":"failed","title":"should allow TenantOwner to create scheduled report","duration":7156,"failureMessages":["expected 201 \"Created\", got 401 \"Unauthorized\""],"location":{"line":124,"column":10}},{"ancestorTitles":["","Scheduled Reports Routes Integration Tests","POST /api/v1/scheduled-reports"],"fullName":" Scheduled Reports Routes Integration Tests POST /api/v1/scheduled-reports should allow Accountant to create scheduled report","status":"failed","title":"should allow Accountant to create scheduled report","duration":6708,"failureMessages":["expected 201 \"Created\", got 401 \"Unauthorized\""],"location":{"line":172,"column":10}},{"ancestorTitles":["","Scheduled Reports Routes Integration Tests","POST /api/v1/scheduled-reports"],"fullName":" Scheduled Reports Routes Integration Tests POST /api/v1/scheduled-reports should reject Staff from creating scheduled report","status":"failed","title":"should reject Staff from creating scheduled report","duration":7279,"failureMessages":["expected 403 \"Forbidden\", got 401 \"Unauthorized\""],"location":{"line":218,"column":10}},{"ancestorTitles":["","Scheduled Reports Routes Integration Tests","POST /api/v1/scheduled-reports"],"fullName":" Scheduled Reports Routes Integration Tests POST /api/v1/scheduled-reports should reject ReadOnly from creating scheduled report","status":"failed","title":"should reject ReadOnly from creating scheduled report","duration":6349,"failureMessages":["expected 403 \"Forbidden\", got 401 \"Unauthorized\""],"location":{"line":262,"column":10}},{"ancestorTitles":["","Scheduled Reports Routes Integration Tests","GET /api/v1/scheduled-reports"],"fullName":" Scheduled Reports Routes Integration Tests GET /api/v1/scheduled-reports should list scheduled reports for tenant","status":"failed","title":"should list scheduled reports for tenant","duration":4503,"failureMessages":["expected 201 \"Created\", got 401 \"Unauthorized\""],"location":{"line":282,"column":10}},{"ancestorTitles":["","Scheduled Reports Routes Integration Tests","PUT /api/v1/scheduled-reports/:id"],"fullName":" Scheduled Reports Routes Integration Tests PUT /api/v1/scheduled-reports/:id should update scheduled report","status":"failed","title":"should update scheduled report","duration":3835,"failureMessages":["expected 201 \"Created\", got 401 \"Unauthorized\""],"location":{"line":314,"column":10}},{"ancestorTitles":["","Scheduled Reports Routes Integration Tests","DELETE /api/v1/scheduled-reports/:id"],"fullName":" Scheduled Reports Routes Integration Tests DELETE /api/v1/scheduled-reports/:id should deactivate scheduled report","status":"failed","title":"should deactivate scheduled report","duration":6625,"failureMessages":["Failed to get auth token: E-posta veya şifre hatalı."],"location":{"line":260,"column":15}},{"ancestorTitles":["","Scheduled Reports Routes Integration Tests","Tenant Isolation"],"fullName":" Scheduled Reports Routes Integration Tests Tenant Isolation should prevent accessing other tenant's scheduled reports","status":"failed","title":"should prevent accessing other tenant's scheduled reports","duration":6896,"failureMessages":["expected 404 \"Not Found\", got 401 \"Unauthorized\""],"location":{"line":399,"column":10}}],"startTime":1765221143667,"endTime":1765221193019,"status":"failed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/scheduled-reports.integration.test.ts"},{"assertionResults":[{"ancestorTitles":["","Security Tests","SQL Injection Protection"],"fullName":" Security Tests SQL Injection Protection should prevent SQL injection in search queries","status":"passed","title":"should prevent SQL injection in search queries","duration":17016,"failureMessages":[]},{"ancestorTitles":["","Security Tests","SQL Injection Protection"],"fullName":" Security Tests SQL Injection Protection should prevent SQL injection in ID parameters","status":"passed","title":"should prevent SQL injection in ID parameters","duration":17593,"failureMessages":[]},{"ancestorTitles":["","Security Tests","SQL Injection Protection"],"fullName":" Security Tests SQL Injection Protection should prevent SQL injection in filter parameters","status":"passed","title":"should prevent SQL injection in filter parameters","duration":15974,"failureMessages":[]},{"ancestorTitles":["","Security Tests","XSS Protection"],"fullName":" Security Tests XSS Protection should sanitize user input in company names","status":"passed","title":"should sanitize user input in company names","duration":15723,"failureMessages":[]},{"ancestorTitles":["","Security Tests","XSS Protection"],"fullName":" Security Tests XSS Protection should sanitize user input in invoice descriptions","status":"passed","title":"should sanitize user input in invoice descriptions","duration":13332,"failureMessages":[]},{"ancestorTitles":["","Security Tests","Authentication Security"],"fullName":" Security Tests Authentication Security should reject invalid JWT tokens","status":"passed","title":"should reject invalid JWT tokens","duration":13850,"failureMessages":[]},{"ancestorTitles":["","Security Tests","Authentication Security"],"fullName":" Security Tests Authentication Security should reject expired tokens","status":"passed","title":"should reject expired tokens","duration":8418,"failureMessages":[]},{"ancestorTitles":["","Security Tests","Authentication Security"],"fullName":" Security Tests Authentication Security should reject requests without Authorization header","status":"passed","title":"should reject requests without Authorization header","duration":12640,"failureMessages":[]},{"ancestorTitles":["","Security Tests","Authentication Security"],"fullName":" Security Tests Authentication Security should prevent brute force attacks with rate limiting","status":"passed","title":"should prevent brute force attacks with rate limiting","duration":11241,"failureMessages":[]},{"ancestorTitles":["","Security Tests","Authentication Security"],"fullName":" Security Tests Authentication Security should not reveal if user exists during login","status":"passed","title":"should not reveal if user exists during login","duration":6610,"failureMessages":[]},{"ancestorTitles":["","Security Tests","Authorization Security"],"fullName":" Security Tests Authorization Security should prevent privilege escalation","status":"passed","title":"should prevent privilege escalation","duration":6846,"failureMessages":[]},{"ancestorTitles":["","Security Tests","Authorization Security"],"fullName":" Security Tests Authorization Security should prevent role manipulation via request body","status":"passed","title":"should prevent role manipulation via request body","duration":7134,"failureMessages":[]},{"ancestorTitles":["","Security Tests","Tenant Isolation Security"],"fullName":" Security Tests Tenant Isolation Security should prevent cross-tenant data access via ID manipulation","status":"passed","title":"should prevent cross-tenant data access via ID manipulation","duration":7025,"failureMessages":[]},{"ancestorTitles":["","Security Tests","Tenant Isolation Security"],"fullName":" Security Tests Tenant Isolation Security should prevent cross-tenant data modification","status":"failed","title":"should prevent cross-tenant data modification","duration":5921,"failureMessages":["\nInvalid `prisma.tenant.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/test-utils/test-auth.ts:80:34\n\n  77     await new Promise(resolve => setTimeout(resolve, 50));\n  78   }\n  79 } else {\n→ 80   tenant = await prisma.tenant.create(\nUnique constraint failed on the fields: (`slug`)"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Security Tests","Tenant Isolation Security"],"fullName":" Security Tests Tenant Isolation Security should prevent tenant ID spoofing via header","status":"passed","title":"should prevent tenant ID spoofing via header","duration":8190,"failureMessages":[]},{"ancestorTitles":["","Security Tests","Input Validation Security"],"fullName":" Security Tests Input Validation Security should reject malformed email addresses","status":"passed","title":"should reject malformed email addresses","duration":10405,"failureMessages":[]},{"ancestorTitles":["","Security Tests","Input Validation Security"],"fullName":" Security Tests Input Validation Security should reject extremely long input strings","status":"passed","title":"should reject extremely long input strings","duration":8860,"failureMessages":[]},{"ancestorTitles":["","Security Tests","Input Validation Security"],"fullName":" Security Tests Input Validation Security should reject special characters in tenant slug","status":"failed","title":"should reject special characters in tenant slug","duration":5869,"failureMessages":["expected 'Kısa ad sadece küçük harf, rakam ve tire içerebilir.' to contain 'kısa ad'"],"location":{"line":510,"column":43}},{"ancestorTitles":["","Security Tests","Input Validation Security"],"fullName":" Security Tests Input Validation Security should sanitize numeric inputs","status":"failed","title":"should sanitize numeric inputs","duration":5876,"failureMessages":["expected [ 400, 500 ] to include 401"],"location":{"line":532,"column":26}},{"ancestorTitles":["","Security Tests","Session Management Security"],"fullName":" Security Tests Session Management Security should invalidate tokens after user is deactivated","status":"failed","title":"should invalidate tokens after user is deactivated","duration":4890,"failureMessages":["\nInvalid `prisma.user.update()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/security.integration.test.ts:544:25\n\n  541 \n  542 // Deactivate the user\n  543 const prisma = getTestPrisma();\n→ 544 await prisma.user.update(\nAn operation failed because it depends on one or more records that were required but not found. Record to update not found."],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Security Tests","Session Management Security"],"fullName":" Security Tests Session Management Security should reject tokens for users without active memberships","status":"passed","title":"should reject tokens for users without active memberships","duration":7569,"failureMessages":[]},{"ancestorTitles":["","Security Tests","Password Security"],"fullName":" Security Tests Password Security should hash passwords and not store them in plain text","status":"passed","title":"should hash passwords and not store them in plain text","duration":6749,"failureMessages":[]},{"ancestorTitles":["","Security Tests","Password Security"],"fullName":" Security Tests Password Security should reject weak passwords","status":"passed","title":"should reject weak passwords","duration":5511,"failureMessages":[]},{"ancestorTitles":["","Security Tests","CSRF Protection"],"fullName":" Security Tests CSRF Protection should validate request origin for state-changing operations","status":"passed","title":"should validate request origin for state-changing operations","duration":6422,"failureMessages":[]},{"ancestorTitles":["","Security Tests","Path Traversal Protection"],"fullName":" Security Tests Path Traversal Protection should prevent path traversal in file names","status":"failed","title":"should prevent path traversal in file names","duration":13702,"failureMessages":["\nInvalid `prisma.clientCompany.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/security.integration.test.ts:704:50\n\n  701 \n  702 // First create a client company\n  703 const prisma = getTestPrisma();\n→ 704 const company = await prisma.clientCompany.create(\nForeign key constraint violated: `client_companies_tenant_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Security Tests","Data Exposure"],"fullName":" Security Tests Data Exposure should not expose sensitive data in error messages","status":"failed","title":"should not expose sensitive data in error messages","duration":11394,"failureMessages":["\nInvalid `prisma.userTenantMembership.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/test-utils/test-auth.ts:130:52\n\n  127   });\n  128 } else {\n  129   // Create new membership\n→ 130   membership = await prisma.userTenantMembership.create(\nForeign key constraint violated: `user_tenant_memberships_tenant_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Security Tests","Data Exposure"],"fullName":" Security Tests Data Exposure should not expose user passwords in API responses","status":"passed","title":"should not expose user passwords in API responses","duration":11806,"failureMessages":[]}],"startTime":1765220722765,"endTime":1765220989345,"status":"failed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/security.integration.test.ts"},{"assertionResults":[{"ancestorTitles":["","Settings Integration Tests","GET /api/v1/settings/tenant"],"fullName":" Settings Integration Tests GET /api/v1/settings/tenant should return default tenant settings if none exist","status":"failed","title":"should return default tenant settings if none exist","duration":10592,"failureMessages":["expected 200 \"OK\", got 401 \"Unauthorized\""],"location":{"line":70,"column":10}},{"ancestorTitles":["","Settings Integration Tests","GET /api/v1/settings/tenant"],"fullName":" Settings Integration Tests GET /api/v1/settings/tenant should return existing tenant settings","status":"passed","title":"should return existing tenant settings","duration":6405,"failureMessages":[]},{"ancestorTitles":["","Settings Integration Tests","PUT /api/v1/settings/tenant"],"fullName":" Settings Integration Tests PUT /api/v1/settings/tenant should allow TenantOwner to update settings","status":"passed","title":"should allow TenantOwner to update settings","duration":7231,"failureMessages":[]},{"ancestorTitles":["","Settings Integration Tests","PUT /api/v1/settings/tenant"],"fullName":" Settings Integration Tests PUT /api/v1/settings/tenant should allow Accountant to update settings","status":"failed","title":"should allow Accountant to update settings","duration":7210,"failureMessages":["Failed to get auth token: E-posta veya şifre hatalı."],"location":{"line":260,"column":15}},{"ancestorTitles":["","Settings Integration Tests","PUT /api/v1/settings/tenant"],"fullName":" Settings Integration Tests PUT /api/v1/settings/tenant should reject Staff from updating settings","status":"failed","title":"should reject Staff from updating settings","duration":5239,"failureMessages":["\nInvalid `prisma.userTenantMembership.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/test-utils/test-auth.ts:130:52\n\n  127   });\n  128 } else {\n  129   // Create new membership\n→ 130   membership = await prisma.userTenantMembership.create(\nForeign key constraint violated: `user_tenant_memberships_user_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","Settings Integration Tests","PUT /api/v1/settings/tenant"],"fullName":" Settings Integration Tests PUT /api/v1/settings/tenant should reject ReadOnly from updating settings","status":"failed","title":"should reject ReadOnly from updating settings","duration":8828,"failureMessages":["Failed to get auth token: E-posta veya şifre hatalı."],"location":{"line":260,"column":15}},{"ancestorTitles":["","Settings Integration Tests","GET /api/v1/settings/user"],"fullName":" Settings Integration Tests GET /api/v1/settings/user should return user settings with effective values","status":"passed","title":"should return user settings with effective values","duration":8551,"failureMessages":[]},{"ancestorTitles":["","Settings Integration Tests","PUT /api/v1/settings/user"],"fullName":" Settings Integration Tests PUT /api/v1/settings/user should allow user to update their own settings","status":"failed","title":"should allow user to update their own settings","duration":13358,"failureMessages":["expected 200 \"OK\", got 401 \"Unauthorized\""],"location":{"line":201,"column":10}},{"ancestorTitles":["","Settings Integration Tests","PUT /api/v1/settings/user"],"fullName":" Settings Integration Tests PUT /api/v1/settings/user should return effective settings after update","status":"failed","title":"should return effective settings after update","duration":11777,"failureMessages":["expected 200 \"OK\", got 401 \"Unauthorized\""],"location":{"line":218,"column":10}},{"ancestorTitles":["","Settings Integration Tests","Tenant Isolation"],"fullName":" Settings Integration Tests Tenant Isolation should only return settings for current tenant","status":"failed","title":"should only return settings for current tenant","duration":13535,"failureMessages":["expected 200 \"OK\", got 401 \"Unauthorized\""],"location":{"line":244,"column":10}}],"startTime":1765221338898,"endTime":1765221431627,"status":"failed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/routes/__tests__/settings.integration.test.ts"},{"assertionResults":[{"ancestorTitles":["","AI Pipeline & Risk Features Integration Tests","OCR Service"],"fullName":" AI Pipeline & Risk Features Integration Tests OCR Service should return non-empty raw_text and engineName for PDF file","status":"passed","title":"should return non-empty raw_text and engineName for PDF file","duration":1941,"failureMessages":[]},{"ancestorTitles":["","AI Pipeline & Risk Features Integration Tests","OCR Service"],"fullName":" AI Pipeline & Risk Features Integration Tests OCR Service should return non-empty raw_text and engineName for image file","status":"passed","title":"should return non-empty raw_text and engineName for image file","duration":2441,"failureMessages":[]},{"ancestorTitles":["","AI Pipeline & Risk Features Integration Tests","Document Parser Service"],"fullName":" AI Pipeline & Risk Features Integration Tests Document Parser Service should parse OCR text for invoice type and return structured data","status":"passed","title":"should parse OCR text for invoice type and return structured data","duration":5078,"failureMessages":[]},{"ancestorTitles":["","AI Pipeline & Risk Features Integration Tests","Document Parser Service"],"fullName":" AI Pipeline & Risk Features Integration Tests Document Parser Service should parse OCR text for bank statement type","status":"passed","title":"should parse OCR text for bank statement type","duration":1925,"failureMessages":[]},{"ancestorTitles":["","AI Pipeline & Risk Features Integration Tests","Risk Feature Service"],"fullName":" AI Pipeline & Risk Features Integration Tests Risk Feature Service should generate risk features with DUE_BEFORE_ISSUE flag when due_date < issue_date","status":"passed","title":"should generate risk features with DUE_BEFORE_ISSUE flag when due_date < issue_date","duration":2347,"failureMessages":[]},{"ancestorTitles":["","AI Pipeline & Risk Features Integration Tests","Risk Feature Service"],"fullName":" AI Pipeline & Risk Features Integration Tests Risk Feature Service should generate risk features with DUPLICATE_INVOICE_NUMBER flag","status":"passed","title":"should generate risk features with DUPLICATE_INVOICE_NUMBER flag","duration":3054,"failureMessages":[]}],"startTime":1765221364701,"endTime":1765221381489,"status":"passed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/services/__tests__/ai-pipeline.integration.test.ts"},{"assertionResults":[{"ancestorTitles":["","ClientCompanyService","listClientCompanies"],"fullName":" ClientCompanyService listClientCompanies should return paginated list of client companies for a tenant","status":"passed","title":"should return paginated list of client companies for a tenant","duration":1023,"failureMessages":[]},{"ancestorTitles":["","ClientCompanyService","listClientCompanies"],"fullName":" ClientCompanyService listClientCompanies should filter by isActive when provided","status":"passed","title":"should filter by isActive when provided","duration":1,"failureMessages":[]},{"ancestorTitles":["","ClientCompanyService","listClientCompanies"],"fullName":" ClientCompanyService listClientCompanies should search by name or tax number when search filter is provided","status":"passed","title":"should search by name or tax number when search filter is provided","duration":2,"failureMessages":[]},{"ancestorTitles":["","ClientCompanyService","getClientCompanyById"],"fullName":" ClientCompanyService getClientCompanyById should return client company with stats when found","status":"passed","title":"should return client company with stats when found","duration":1,"failureMessages":[]},{"ancestorTitles":["","ClientCompanyService","getClientCompanyById"],"fullName":" ClientCompanyService getClientCompanyById should throw NotFoundError when client company not found","status":"passed","title":"should throw NotFoundError when client company not found","duration":2,"failureMessages":[]},{"ancestorTitles":["","ClientCompanyService","createClientCompany"],"fullName":" ClientCompanyService createClientCompany should create a new client company","status":"passed","title":"should create a new client company","duration":1,"failureMessages":[]},{"ancestorTitles":["","ClientCompanyService","createClientCompany"],"fullName":" ClientCompanyService createClientCompany should throw ValidationError when tax number already exists","status":"passed","title":"should throw ValidationError when tax number already exists","duration":2,"failureMessages":[]},{"ancestorTitles":["","ClientCompanyService","updateClientCompany"],"fullName":" ClientCompanyService updateClientCompany should update an existing client company","status":"passed","title":"should update an existing client company","duration":1,"failureMessages":[]},{"ancestorTitles":["","ClientCompanyService","updateClientCompany"],"fullName":" ClientCompanyService updateClientCompany should throw NotFoundError when client company not found","status":"passed","title":"should throw NotFoundError when client company not found","duration":1,"failureMessages":[]},{"ancestorTitles":["","ClientCompanyService","deleteClientCompany"],"fullName":" ClientCompanyService deleteClientCompany should delete an existing client company","status":"passed","title":"should delete an existing client company","duration":1,"failureMessages":[]},{"ancestorTitles":["","ClientCompanyService","deleteClientCompany"],"fullName":" ClientCompanyService deleteClientCompany should throw NotFoundError when client company not found","status":"passed","title":"should throw NotFoundError when client company not found","duration":1,"failureMessages":[]}],"startTime":1765221433210,"endTime":1765221434246,"status":"passed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/services/__tests__/client-company-service.test.ts"},{"assertionResults":[{"ancestorTitles":["","DocumentAIService","getDocumentAIAnalysis"],"fullName":" DocumentAIService getDocumentAIAnalysis should return AI analysis for a document","status":"passed","title":"should return AI analysis for a document","duration":1000,"failureMessages":[]},{"ancestorTitles":["","DocumentAIService","getDocumentAIAnalysis"],"fullName":" DocumentAIService getDocumentAIAnalysis should throw NotFoundError when document not found","status":"passed","title":"should throw NotFoundError when document not found","duration":2,"failureMessages":[]},{"ancestorTitles":["","DocumentAIService","getDocumentAIAnalysis"],"fullName":" DocumentAIService getDocumentAIAnalysis should enforce tenant isolation","status":"passed","title":"should enforce tenant isolation","duration":1,"failureMessages":[]},{"ancestorTitles":["","DocumentAIService","getDocumentAIAnalysis"],"fullName":" DocumentAIService getDocumentAIAnalysis should return null for missing AI results","status":"passed","title":"should return null for missing AI results","duration":2,"failureMessages":[]}],"startTime":1765221463211,"endTime":1765221464216,"status":"passed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/services/__tests__/document-ai-service.test.ts"},{"assertionResults":[{"ancestorTitles":["","DocumentService","uploadDocument"],"fullName":" DocumentService uploadDocument should upload a document successfully","status":"passed","title":"should upload a document successfully","duration":874,"failureMessages":[]},{"ancestorTitles":["","DocumentService","uploadDocument"],"fullName":" DocumentService uploadDocument should throw ValidationError when client company doesn't belong to tenant","status":"passed","title":"should throw ValidationError when client company doesn't belong to tenant","duration":2,"failureMessages":[]},{"ancestorTitles":["","DocumentService","uploadDocument"],"fullName":" DocumentService uploadDocument should throw ValidationError when file size exceeds limit","status":"passed","title":"should throw ValidationError when file size exceeds limit","duration":1,"failureMessages":[]},{"ancestorTitles":["","DocumentService","listDocuments"],"fullName":" DocumentService listDocuments should return paginated list of documents for a tenant","status":"passed","title":"should return paginated list of documents for a tenant","duration":5,"failureMessages":[]},{"ancestorTitles":["","DocumentService","getDocumentById"],"fullName":" DocumentService getDocumentById should return document with extracted data when found","status":"passed","title":"should return document with extracted data when found","duration":1,"failureMessages":[]},{"ancestorTitles":["","DocumentService","getDocumentById"],"fullName":" DocumentService getDocumentById should throw NotFoundError when document not found","status":"passed","title":"should throw NotFoundError when document not found","duration":1,"failureMessages":[]},{"ancestorTitles":["","DocumentService","deleteDocument"],"fullName":" DocumentService deleteDocument should soft delete a document","status":"passed","title":"should soft delete a document","duration":1,"failureMessages":[]}],"startTime":1765221434793,"endTime":1765221435679,"status":"passed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/services/__tests__/document-service.test.ts"},{"assertionResults":[{"ancestorTitles":["","InvoiceService","createInvoice"],"fullName":" InvoiceService createInvoice should create an invoice with lines","status":"passed","title":"should create an invoice with lines","duration":1092,"failureMessages":[]},{"ancestorTitles":["","InvoiceService","createInvoice"],"fullName":" InvoiceService createInvoice should throw ValidationError when client company doesn't belong to tenant","status":"passed","title":"should throw ValidationError when client company doesn't belong to tenant","duration":4,"failureMessages":[]},{"ancestorTitles":["","InvoiceService","updateInvoiceStatus"],"fullName":" InvoiceService updateInvoiceStatus should update invoice status","status":"passed","title":"should update invoice status","duration":2,"failureMessages":[]},{"ancestorTitles":["","InvoiceService","updateInvoiceStatus"],"fullName":" InvoiceService updateInvoiceStatus should throw NotFoundError when invoice not found","status":"passed","title":"should throw NotFoundError when invoice not found","duration":1,"failureMessages":[]},{"ancestorTitles":["","InvoiceService","listInvoices"],"fullName":" InvoiceService listInvoices should return paginated list of invoices for a tenant","status":"passed","title":"should return paginated list of invoices for a tenant","duration":3,"failureMessages":[]}],"startTime":1765221456404,"endTime":1765221457506,"status":"passed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/services/__tests__/invoice-service.test.ts"},{"assertionResults":[{"ancestorTitles":["","ReportingService","generateCompanyFinancialSummary"],"fullName":" ReportingService generateCompanyFinancialSummary should return correct structure","status":"passed","title":"should return correct structure","duration":6876,"failureMessages":[]},{"ancestorTitles":["","ReportingService","generateCompanyFinancialSummary"],"fullName":" ReportingService generateCompanyFinancialSummary should respect tenantId","status":"passed","title":"should respect tenantId","duration":5593,"failureMessages":[]},{"ancestorTitles":["","ReportingService","generateCompanyFinancialSummary"],"fullName":" ReportingService generateCompanyFinancialSummary should calculate sales and purchases correctly","status":"failed","title":"should calculate sales and purchases correctly","duration":6629,"failureMessages":["User cmixj3epe01vwfx6dtl5touoj not found. Create user before creating document."],"location":{"line":245,"column":13}},{"ancestorTitles":["","ReportingService","generateCompanyFinancialSummary"],"fullName":" ReportingService generateCompanyFinancialSummary should count invoices by status","status":"failed","title":"should count invoices by status","duration":3902,"failureMessages":["expected +0 to be 1 // Object.is equality"],"location":{"line":210,"column":61}},{"ancestorTitles":["","ReportingService","generateCompanyFinancialSummary"],"fullName":" ReportingService generateCompanyFinancialSummary should return 404 if company not in tenant","status":"passed","title":"should return 404 if company not in tenant","duration":3780,"failureMessages":[]},{"ancestorTitles":["","ReportingService","generateCompanyRiskSummary"],"fullName":" ReportingService generateCompanyRiskSummary should return correct structure","status":"passed","title":"should return correct structure","duration":5615,"failureMessages":[]},{"ancestorTitles":["","ReportingService","generateCompanyRiskSummary"],"fullName":" ReportingService generateCompanyRiskSummary should respect tenantId","status":"passed","title":"should respect tenantId","duration":3520,"failureMessages":[]},{"ancestorTitles":["","ReportingService","generateCompanyRiskSummary"],"fullName":" ReportingService generateCompanyRiskSummary should include latest risk score","status":"passed","title":"should include latest risk score","duration":3548,"failureMessages":[]},{"ancestorTitles":["","ReportingService","generateCompanyRiskSummary"],"fullName":" ReportingService generateCompanyRiskSummary should count open alerts by severity","status":"failed","title":"should count open alerts by severity","duration":4792,"failureMessages":["User cmixj3y9g022ffx6d35u7gqei not found. Create user before creating document."],"location":{"line":245,"column":13}},{"ancestorTitles":["","ReportingService","generateTenantPortfolioReport"],"fullName":" ReportingService generateTenantPortfolioReport should return correct structure","status":"failed","title":"should return correct structure","duration":3175,"failureMessages":["\nInvalid `prisma.userTenantMembership.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/test-utils/test-auth.ts:130:52\n\n  127   });\n  128 } else {\n  129   // Create new membership\n→ 130   membership = await prisma.userTenantMembership.create(\nForeign key constraint violated: `user_tenant_memberships_tenant_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","ReportingService","generateTenantPortfolioReport"],"fullName":" ReportingService generateTenantPortfolioReport should respect tenantId","status":"passed","title":"should respect tenantId","duration":3075,"failureMessages":[]},{"ancestorTitles":["","ReportingService","generateTenantPortfolioReport"],"fullName":" ReportingService generateTenantPortfolioReport should include all companies","status":"passed","title":"should include all companies","duration":3743,"failureMessages":[]},{"ancestorTitles":["","ReportingService","generateDocumentActivityReport"],"fullName":" ReportingService generateDocumentActivityReport should return correct structure","status":"passed","title":"should return correct structure","duration":3659,"failureMessages":[]},{"ancestorTitles":["","ReportingService","generateDocumentActivityReport"],"fullName":" ReportingService generateDocumentActivityReport should respect tenantId","status":"passed","title":"should respect tenantId","duration":6012,"failureMessages":[]},{"ancestorTitles":["","ReportingService","generateDocumentActivityReport"],"fullName":" ReportingService generateDocumentActivityReport should work with and without clientCompanyId","status":"failed","title":"should work with and without clientCompanyId","duration":7471,"failureMessages":["\nInvalid `prisma.userTenantMembership.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/test-utils/test-auth.ts:130:52\n\n  127   });\n  128 } else {\n  129   // Create new membership\n→ 130   membership = await prisma.userTenantMembership.create(\nForeign key constraint violated: `user_tenant_memberships_tenant_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","ReportingService","generateDocumentActivityReport"],"fullName":" ReportingService generateDocumentActivityReport should group by type and status correctly","status":"passed","title":"should group by type and status correctly","duration":6152,"failureMessages":[]}],"startTime":1765221129656,"endTime":1765221207200,"status":"failed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/services/__tests__/reporting-service.test.ts"},{"assertionResults":[{"ancestorTitles":["","Risk Engine & Alerts Integration Tests","Document Risk Scoring"],"fullName":" Risk Engine & Alerts Integration Tests Document Risk Scoring should compute risk score with severity and triggered rule codes","status":"passed","title":"should compute risk score with severity and triggered rule codes","duration":6305,"failureMessages":[]},{"ancestorTitles":["","Risk Engine & Alerts Integration Tests","Company Risk Scoring"],"fullName":" Risk Engine & Alerts Integration Tests Company Risk Scoring should generate ClientCompanyRiskScore with correct severity","status":"passed","title":"should generate ClientCompanyRiskScore with correct severity","duration":3428,"failureMessages":[]},{"ancestorTitles":["","Risk Engine & Alerts Integration Tests","Risk Alerts"],"fullName":" Risk Engine & Alerts Integration Tests Risk Alerts should create RiskAlert for high-risk document","status":"passed","title":"should create RiskAlert for high-risk document","duration":6480,"failureMessages":[]},{"ancestorTitles":["","Risk Engine & Alerts Integration Tests","Risk Alerts"],"fullName":" Risk Engine & Alerts Integration Tests Risk Alerts should create RiskAlert for high-risk company","status":"passed","title":"should create RiskAlert for high-risk company","duration":3811,"failureMessages":[]}],"startTime":1765221108031,"endTime":1765221128056,"status":"passed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/services/__tests__/risk-engine.integration.test.ts"},{"assertionResults":[{"ancestorTitles":["","ScheduledReportService","createScheduledReport"],"fullName":" ScheduledReportService createScheduledReport should create a scheduled report with valid data","status":"passed","title":"should create a scheduled report with valid data","duration":10488,"failureMessages":[]},{"ancestorTitles":["","ScheduledReportService","createScheduledReport"],"fullName":" ScheduledReportService createScheduledReport should throw ValidationError for invalid report code","status":"passed","title":"should throw ValidationError for invalid report code","duration":13790,"failureMessages":[]},{"ancestorTitles":["","ScheduledReportService","createScheduledReport"],"fullName":" ScheduledReportService createScheduledReport should throw NotFoundError for client company from different tenant","status":"passed","title":"should throw NotFoundError for client company from different tenant","duration":12852,"failureMessages":[]},{"ancestorTitles":["","ScheduledReportService","createScheduledReport"],"fullName":" ScheduledReportService createScheduledReport should validate recipients array","status":"passed","title":"should validate recipients array","duration":7804,"failureMessages":[]},{"ancestorTitles":["","ScheduledReportService","listScheduledReports"],"fullName":" ScheduledReportService listScheduledReports should return only scheduled reports for the tenant","status":"passed","title":"should return only scheduled reports for the tenant","duration":7653,"failureMessages":[]},{"ancestorTitles":["","ScheduledReportService","getScheduledReportById"],"fullName":" ScheduledReportService getScheduledReportById should return scheduled report for correct tenant","status":"failed","title":"should return scheduled report for correct tenant","duration":9152,"failureMessages":["Geçersiz rapor kodu: TENANT_PORTFOLIO"],"location":{"line":37,"column":13}},{"ancestorTitles":["","ScheduledReportService","getScheduledReportById"],"fullName":" ScheduledReportService getScheduledReportById should throw NotFoundError for report from different tenant","status":"failed","title":"should throw NotFoundError for report from different tenant","duration":6205,"failureMessages":["Geçersiz rapor kodu: TENANT_PORTFOLIO"],"location":{"line":37,"column":13}},{"ancestorTitles":["","ScheduledReportService","updateScheduledReport"],"fullName":" ScheduledReportService updateScheduledReport should update scheduled report","status":"passed","title":"should update scheduled report","duration":5511,"failureMessages":[]},{"ancestorTitles":["","ScheduledReportService","deactivateScheduledReport"],"fullName":" ScheduledReportService deactivateScheduledReport should deactivate scheduled report","status":"failed","title":"should deactivate scheduled report","duration":4089,"failureMessages":["\nInvalid `prisma.userTenantMembership.create()` invocation in\n/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/test-utils/test-auth.ts:130:52\n\n  127   });\n  128 } else {\n  129   // Create new membership\n→ 130   membership = await prisma.userTenantMembership.create(\nForeign key constraint violated: `user_tenant_memberships_tenant_id_fkey (index)`"],"location":{"line":121,"column":7315}},{"ancestorTitles":["","ScheduledReportService","listExecutionLogsForScheduledReport"],"fullName":" ScheduledReportService listExecutionLogsForScheduledReport should return execution logs for scheduled report","status":"passed","title":"should return execution logs for scheduled report","duration":6116,"failureMessages":[]},{"ancestorTitles":["","ScheduledReportService","listRecentExecutionLogsForTenant"],"fullName":" ScheduledReportService listRecentExecutionLogsForTenant should return recent execution logs for tenant","status":"passed","title":"should return recent execution logs for tenant","duration":4258,"failureMessages":[]}],"startTime":1765221209232,"endTime":1765221297155,"status":"failed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/services/__tests__/scheduled-report-service.test.ts"},{"assertionResults":[{"ancestorTitles":["","TransactionService","createTransaction"],"fullName":" TransactionService createTransaction should create a transaction with balanced debit and credit","status":"passed","title":"should create a transaction with balanced debit and credit","duration":978,"failureMessages":[]},{"ancestorTitles":["","TransactionService","createTransaction"],"fullName":" TransactionService createTransaction should throw ValidationError when debit and credit totals don't match","status":"passed","title":"should throw ValidationError when debit and credit totals don't match","duration":3,"failureMessages":[]},{"ancestorTitles":["","TransactionService","createTransaction"],"fullName":" TransactionService createTransaction should throw ValidationError when transaction has less than 2 lines","status":"passed","title":"should throw ValidationError when transaction has less than 2 lines","duration":1,"failureMessages":[]},{"ancestorTitles":["","TransactionService","listTransactions"],"fullName":" TransactionService listTransactions should return paginated list of transactions for a tenant","status":"passed","title":"should return paginated list of transactions for a tenant","duration":2,"failureMessages":[]},{"ancestorTitles":["","TransactionService","listTransactions"],"fullName":" TransactionService listTransactions should filter by client company when provided","status":"passed","title":"should filter by client company when provided","duration":2,"failureMessages":[]}],"startTime":1765221335769,"endTime":1765221336756,"status":"passed","message":"","name":"/Users/md/Desktop/MyProjects-2025/AI Muhasebi/AI-Muhasebi/apps/backend-api/src/services/__tests__/transaction-service.test.ts"}]}